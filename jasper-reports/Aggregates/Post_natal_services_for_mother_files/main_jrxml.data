<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.12.2.final using JasperReports Library version 6.11.0  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Aggregate_3Groups" pageWidth="1500" pageHeight="720" columnWidth="1080" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="fa1a9231-754c-4c0f-8a57-3e034206cd5a">
	<property name="ireport.jasperserver.url" value="https://reporting-jasper.avniproject.org/jasperserver/"/>
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="JSSCP"/>
	<property name="ireport.jasperserver.user" value="NupoorK"/>
	<property name="ireport.jasperserver.reportUnit" value="/JSSCP/Reports/Aggregates/Post_natal_services_for_mother"/>
	<template><![CDATA["repo:/Templates/Styles/AggregateReportStyles.jrtx"]]></template>
	<parameter name="PARAM_DATE_START" class="java.sql.Timestamp"/>
	<parameter name="PARAM_DATE_END" class="java.sql.Timestamp"/>
	<parameter name="PARAM_VILLAGE_NAME" class="java.util.List" nestedType="java.lang.String"/>
	<parameter name="PARAM_CLUSTER_NAME" class="java.util.List" nestedType="java.lang.String"/>
	<parameter name="PARAM_USER_NAME" class="java.util.List" nestedType="java.lang.String"/>
	<parameter name="PARAM_AGE_GROUP" class="java.lang.String"/>
	<queryString language="SQL">
		<![CDATA[with pnc_data as 
             (select distinct pnc."Ind.Id" "Ind.Id",             		 
             		 COUNT(*) OVER(PARTITION BY  pnc."Ind.Id") number_of_visits,             		   
                     ROW_NUMBER() OVER (PARTITION BY pnc."Ind.Id"  ORDER BY  pnc."Enc.encounter_date_time" ) row_num 
             from  jsscp_mother_pnc_visit_view pnc    
              left join jsscp_delivery_view delivery on  delivery."Enl.Id"=  pnc."Enl.Id"        
             where   pnc."Enl.is_voided" = false and    pnc."Enc.encounter_date_time" is not null and pnc."Enc.is_voided" = false
                     and $X{IN,pnc."Ind.cluster" ,PARAM_CLUSTER_NAME}
            		 and $X{IN,pnc."Ind.village" ,PARAM_VILLAGE_NAME}
            		 and $X{IN,pnc."Enc.username",PARAM_USER_NAME}
            		 and $X{BETWEEN,pnc."Enc.encounter_date_time",PARAM_DATE_START, PARAM_DATE_END}
            		 and (($P{PARAM_AGE_GROUP} notnull and (
                     extract('year' from age(pnc."Ind.date_of_birth")) between split_part($P{PARAM_AGE_GROUP}, '-', 1)::INTEGER
                     and split_part($P{PARAM_AGE_GROUP}, '-', 2)::INTEGER
                    )) or ($P{PARAM_AGE_GROUP} isnull))) ,
            		 
            delivery_data as 
             (select distinct delivery."Ind.Id" "Ind.Id"
             from  jsscp_delivery_view delivery         
             where   delivery."Enl.is_voided" = false and    delivery."Enc.encounter_date_time" is not null
                     and $X{IN,delivery."Ind.cluster" ,PARAM_CLUSTER_NAME}
            		 and $X{IN,delivery."Ind.village" ,PARAM_VILLAGE_NAME}
            		 and $X{IN,delivery."Enc.username",PARAM_USER_NAME}
            		 and $X{BETWEEN,delivery."Enc.encounter_date_time",PARAM_DATE_START, PARAM_DATE_END}
            		 and (($P{PARAM_AGE_GROUP} notnull and (
                     extract('year' from age(delivery."Ind.date_of_birth")) between split_part($P{PARAM_AGE_GROUP}, '-', 1)::INTEGER
                     and split_part($P{PARAM_AGE_GROUP}, '-', 2)::INTEGER
                    )) or ($P{PARAM_AGE_GROUP} isnull)) ),
             
             pnc_completed as (select count(*) from (select ROW_NUMBER() OVER (PARTITION BY pnc."Ind.Id"  ORDER BY  pnc."Enc.encounter_date_time" desc) row_num 
             from  jsscp_mother_pnc_visit_view pnc
             where   pnc."Enl.is_voided" = false and pnc."Enc.encounter_date_time" is not null and pnc."Enc.is_voided" = false
                     and $X{IN,pnc."Ind.cluster" ,PARAM_CLUSTER_NAME}
            		 and $X{IN,pnc."Ind.village" ,PARAM_VILLAGE_NAME}
            		 and $X{IN,pnc."Enc.username",PARAM_USER_NAME}
            		 and $X{BETWEEN,pnc."Enc.encounter_date_time",PARAM_DATE_START, PARAM_DATE_END}
            		 and (($P{PARAM_AGE_GROUP} notnull and (
                     extract('year' from age(pnc."Ind.date_of_birth")) between split_part($P{PARAM_AGE_GROUP}, '-', 1)::INTEGER
                     and split_part($P{PARAM_AGE_GROUP}, '-', 2)::INTEGER
                    )) or ($P{PARAM_AGE_GROUP} isnull))   ) partitioned_data
    		 where row_num = 1)
            
            
            

select unnest(array ['Total PNC visits for mother conducted by MCHW',
					 'Total mothers with delivery reported',
					 'Total number of mothers with PNC Visits',
					 'Number of mothers with 1 PNC visit',
					 'Number of mothers with 2 PNC visits',
					 'Number of mothers with 3 PNC visits',
					 'Number of mothers with 4 PNC visits',
					 'Number of mothers with 5 PNC visits',
					 'Number of mothers with 6 PNC visits'
					  ]) as "Characteristics",
       unnest(array [ count("Ind.Id"),
       				 (select count(*) from delivery_data),
      				 (select * from pnc_completed),    				 
       				 count(*) filter (where number_of_visits ='1' and row_num ='1'),
       				 count(*) filter (where number_of_visits ='2' and row_num ='2'),
       				 count(*) filter (where number_of_visits ='3' and row_num ='3'),
       				 count(*) filter (where number_of_visits ='4' and row_num ='4'),
       				 count(*) filter (where number_of_visits ='5' and row_num ='5'),
       				 count(*) filter (where number_of_visits ='6' and row_num ='6')
       				 ]) 
       				  as "Number",
       unnest(array ['NA',
       				 'NA',
       				 'NA',
       				 nullif(((count(*) filter (where number_of_visits ='1' and row_num ='1')) * 100.0 )/ (select count("Ind.Id") from delivery_data),0)::TEXT,
       				 nullif(((count(*) filter (where number_of_visits ='2' and row_num ='2')) * 100.0) / (select count("Ind.Id") from delivery_data),0)::TEXT,
       				 nullif(((count(*) filter (where number_of_visits ='3' and row_num ='3')) * 100.0) / (select count("Ind.Id") from delivery_data),0)::TEXT,
       				 nullif(((count(*) filter (where number_of_visits ='4' and row_num ='4')) * 100.0) / (select count("Ind.Id") from delivery_data),0)::TEXT,
       				 nullif(((count(*) filter (where number_of_visits ='5' and row_num ='5')) * 100.0) / (select count("Ind.Id") from delivery_data),0)::TEXT,
       				 nullif(((count(*) filter (where number_of_visits ='6' and row_num ='6')) * 100.0) / (select count("Ind.Id") from delivery_data),0)::TEXT]) 
       				 as "Proportion"
from pnc_data pnc;]]>
	</queryString>
	<field name="Characteristics" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="Characteristics"/>
	</field>
	<field name="Number" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.label" value="Number"/>
	</field>
	<field name="Proportion" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="Proportion"/>
	</field>
	<variable name="DYNAMIC_WHERE" class="java.lang.String">
		<variableExpression><![CDATA[$F{Characteristics}.equals("Total PNC visits for mother conducted by MCHW") ? "1 = 1" :
$F{Characteristics}.equals("Total mothers with delivery reported") ? "1 = 1" :
$F{Characteristics}.equals("Total number of mothers with PNC Visits") ? "1 = 1"  :
$F{Characteristics}.equals("Number of mothers with 1 PNC visits") ? "number_of_visits ='1'" :
$F{Characteristics}.equals("Number of mothers with 2 PNC visits") ? "number_of_visits ='2'" :
$F{Characteristics}.equals("Number of mothers with 3 PNC visits") ? "number_of_visits ='3'" :
$F{Characteristics}.equals("Number of mothers with 4 PNC visits") ? "number_of_visits ='4'" :
$F{Characteristics}.equals("Number of mothers with 5 PNC visits") ? "number_of_visits ='5'" :
$F{Characteristics}.equals("Number of mothers with 6 PNC visits") ? "number_of_visits ='6'" :
"and 1=1"]]></variableExpression>
	</variable>
	<background>
		<band height="100" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
		</band>
	</background>
	<title>
		<band height="50" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<staticText>
				<reportElement style="ReportTitle" x="-100" y="0" width="680" height="50" uuid="b41c1dbc-657e-4f9f-93da-2951563f95d4"/>
				<text><![CDATA[Post natal services for mother]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="30" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<staticText>
				<reportElement style="ColumnHeader" x="0" y="0" width="300" height="30" uuid="6bbeb455-a64f-4ad6-98f4-4344d2a69ced"/>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
				</box>
				<text><![CDATA[Characteristics]]></text>
			</staticText>
			<staticText>
				<reportElement style="ColumnHeader" x="300" y="0" width="80" height="30" uuid="6bbeb455-a64f-4ad6-98f4-4344d2a69ced"/>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
				</box>
				<text><![CDATA[Number]]></text>
			</staticText>
			<staticText>
				<reportElement style="ColumnHeader" x="380" y="0" width="80" height="30" uuid="6bbeb455-a64f-4ad6-98f4-4344d2a69ced"/>
				<box>
					<topPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<leftPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<bottomPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
					<rightPen lineWidth="1.0" lineStyle="Solid" lineColor="#0D0303"/>
				</box>
				<text><![CDATA[Proportion]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="30" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.spreadsheet.SpreadsheetLayout"/>
			<textField textAdjust="StretchHeight">
				<reportElement style="DataRowTextElement" stretchType="RelativeToTallestObject" x="0" y="0" width="300" height="30" uuid="a06291a4-1652-4d4c-bc69-494233474439"/>
				<textFieldExpression><![CDATA[$F{Characteristics}]]></textFieldExpression>
			</textField>
			<textField textAdjust="StretchHeight" hyperlinkType="ReportExecution">
				<reportElement style="DataRowNumericElement" stretchType="RelativeToTallestObject" x="300" y="0" width="80" height="30" uuid="a06291a4-1652-4d4c-bc69-494233474439"/>
				<textFieldExpression><![CDATA[$F{Number}]]></textFieldExpression>
				<hyperlinkWhenExpression><![CDATA[$F{Number} > 0]]></hyperlinkWhenExpression>
				<hyperlinkParameter name="_report">
					<hyperlinkParameterExpression><![CDATA[$F{Characteristics}.equals("Total mothers with delivery reported") ? "/JSSCP/Reports/Linelists/Linelist_for_mother_post_natal_services_delivery" : "/JSSCP/Reports/Linelists/Linelist_for_mother_post_natal_services"]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
				<hyperlinkParameter name="PARAM_DATE_END">
					<hyperlinkParameterExpression><![CDATA[$P{PARAM_DATE_END}]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
				<hyperlinkParameter name="PARAM_DATE_START">
					<hyperlinkParameterExpression><![CDATA[$P{PARAM_DATE_START}]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
				<hyperlinkParameter name="PARAM_VILLAGE_NAME">
					<hyperlinkParameterExpression><![CDATA[$P{PARAM_VILLAGE_NAME}]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
				<hyperlinkParameter name="PARAM_CLUSTER_NAME">
					<hyperlinkParameterExpression><![CDATA[$P{PARAM_CLUSTER_NAME}]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
				<hyperlinkParameter name="PARAM_AGE_GROUP">
					<hyperlinkParameterExpression><![CDATA[$P{PARAM_AGE_GROUP}]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
				<hyperlinkParameter name="PARAM_DYNAMIC_WHERE">
					<hyperlinkParameterExpression><![CDATA[$V{DYNAMIC_WHERE}]]></hyperlinkParameterExpression>
				</hyperlinkParameter>
			</textField>
			<textField textAdjust="StretchHeight">
				<reportElement style="DataRowPreCalculatedPercentageElement" stretchType="RelativeToTallestObject" x="380" y="0" width="80" height="30" uuid="a06291a4-1652-4d4c-bc69-494233474439"/>
				<textFieldExpression><![CDATA[$F{Proportion} == null ? "0%" : $F{Proportion}.equals("NA") ? "NA" : Double.valueOf($F{Proportion})]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
